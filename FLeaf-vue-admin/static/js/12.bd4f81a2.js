(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{373:function(t,a,e){(t.exports=e(9)(!1)).push([t.i,"\n.chart-body[data-v-e6276bd0] {\n  position: relative;\n  width: 100%;\n  height: 70vh;\n  overflow: hidden;\n  border: 1px solid #dcdcdc;\n}\n.chart-body .chart-icons-box[data-v-e6276bd0] {\n  position: absolute;\n  right: 30px;\n  top: 0;\n  z-index: 99;\n  font-size: 16px;\n}\n.chart-body .chart-icons-box > span[data-v-e6276bd0] {\n  margin-right: 30px;\n}\n.chart-body .chart-params-box[data-v-e6276bd0] {\n  position: absolute;\n  right: -2px;\n  top: 0;\n  z-index: 100;\n  background-color: #fff;\n}\n.chart-body .chart-params-box .params-content .ant-card-body[data-v-e6276bd0] {\n  width: 400px;\n  max-height: 460px;\n  overflow: auto;\n}\n.chart-body .chart-nodes-box[data-v-e6276bd0] {\n  position: absolute;\n  left: 16px;\n  top: 16px;\n  z-index: 99;\n}\n.chart-body .chart-nodes-box .chart-nodes-type[data-v-e6276bd0] {\n  height: 300px;\n  overflow-y: auto;\n}\n.chart-body .chart-nodes-box .chart-nodes-type > div[data-v-e6276bd0] {\n  margin-bottom: 8px;\n}\n.chart-body .chart-nodes-box .chart-nodes-type .chart-nodes-type-list li[data-v-e6276bd0] {\n  text-align: center;\n  padding: 8px 12px;\n  border-radius: 6px;\n  margin-top: 8px;\n  cursor: move;\n}\n.chart-body .chart-flow-box[data-v-e6276bd0] {\n  width: 100%;\n  height: 100%;\n}\n",""])},374:function(t,a,e){var n=e(373);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,e(8).default)("4bb45d00",n,!0,{})},427:function(t,a,e){"use strict";e.r(a);var n=e(17),o=e.n(n),s=e(10),i=e.n(s),r=e(6),d=e.n(r),l=e(44),c=e(137),h=e(133),p=e(16),g=e(52),u=e(11),f=e(31),v=e.n(f),b=e(93),m=e(94),k={name:"NodeModal",components:{Form:e(92).a,FormItem:m.a,Input:b.a},props:{data:{type:Object,default:function(){return{}}}},data:function(){return{formModal:{},ruleInline:{label:[{required:!0,message:"请输入节点名称",trigger:"blur"}]}}},watch:{data:function(){this.formModal=i()({},this.data)}},mounted:function(){this.formModal=i()({},this.data)},methods:{getFormData:function(){var t=this;return new v.a(function(a,e){t.$refs.formModal.validate(function(n){if(n){var o=i()({},t.formModal);a(o)}else e()})})},resetFields:function(){this.$refs.formModal.resetFields()}}},C=e(1),y=Object(C.a)(k,function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Form",{ref:"formModal",attrs:{model:t.formModal,rules:t.ruleInline}},[e("FormItem",{attrs:{prop:"label"}},[e("Input",{attrs:{type:"text",placeholder:"节点名称"},model:{value:t.formModal.label,callback:function(a){t.$set(t.formModal,"label",a)},expression:"formModal.label"}})],1)],1)},[],!1,null,null,null).exports,x={name:"FlowChart",components:{Icon:p.a,Card:h.a,PageDemo:g.a,CFlowChart:u.b,Modal:c.a,Button:l.a,NodeModal:y},data:function(){return{isChange:!1,isNodeModal:!1,chartOptions:{zoom:{x:0,y:0,scale:1},isLock:!0,isShowLegend:!1},dragObj:{},dragData:{nodes:[],edges:[]}}},computed:{isLock:function(){return this.chartOptions.isLock}},methods:{checkLock:function(){return!!this.chartOptions.isLock&&(this.$Message.warning("当前处于锁定状态，请解锁后操作！"),!0)},handleIconDrag:function(t){if(!this.checkLock()){var a=t.target.dataset.key;t.dataTransfer.setData("text",a)}},handleDrop:function(t){if(!this.checkLock()){t.preventDefault();var a=this.chartOptions,e=t.dataTransfer.getData("text"),n=document.getElementById("force-svg"),o={type:e,posX:(t.pageX-n.getBoundingClientRect().left-a.zoom.x)/a.zoom.scale,posY:(t.pageY-n.getBoundingClientRect().top-a.zoom.y-30)/a.zoom.scale};"start"==e?(o.label=e,o.type="-1",this.handleVirOk(o)):"end"==e?(o.label=e,o.type="-2",this.handleVirOk(o)):(o.type=e,this.dragObj=d()({},o),this.isNodeModal=!0)}},handleVirOk:function(t){var a=i()({},t),e=i()({},this.dragData);e.nodes.push(a),this.dragData=d()({},e),this.isChange=!0},handleRunFlow:function(){this.$Message.info("运行流程图！")},handleLock:function(){var t=i()({},this.chartOptions),a=!this.chartOptions.isLock;t.isLock=a,this.chartOptions=d()({},t)},handleZoomRepeat:function(){if(!this.checkLock()){var t=i()({},this.chartOptions);t.zoom=i()({},{x:0,y:0,scale:1}),this.chartOptions=d()({},t)}},handleZoomBig:function(){if(!this.checkLock()){var t=i()({},this.chartOptions);t.zoom.scale>3||(t.zoom.scale=t.zoom.scale+.3,this.chartOptions=d()({},t))}},handleZoomSmall:function(){if(!this.checkLock()){var t=i()({},this.chartOptions),a=t.zoom.scale;t.zoom.scale<.2||(t.zoom.scale=a-.2,this.chartOptions=d()({},t))}},handleZoomChange:function(t){if(!this.checkLock()){var a=i()({},this.chartOptions);a.zoom=t,this.chartOptions=d()({},a)}},handleNodesChange:function(t){this.checkLock()||(this.dragData.nodes=t,this.handleChartChange())},handleLinksChange:function(t){this.checkLock()||(this.dragData.edges=t,this.handleChartChange())},handleDeleteNode:function(t){if(!this.checkLock()){var a=i()({},this.dragData),e=a.nodes.filter(function(a){return a.id!=t.id}),n=a.edges.filter(function(a){return a.sourceId!==t.id||a.targetId!==t.id});this.dragData.nodes=[].concat(o()(e)),this.dragData.edges=[].concat(o()(n)),this.handleChartChange()}},handleEditNode:function(t){this.checkLock()||this.$Message.warning(t.nodeId+"节点编辑！")},handleDeleteLink:function(t){if(!this.checkLock()){var a=i()({},this.dragData).edges.filter(function(a){return a.sourceId!=t.sourceId||a.targetId!=t.targetId});this.dragData.edges=[].concat(o()(a)),this.handleChartChange()}},handleChartChange:function(){this.isChange=!0},handleReset:function(t){this.$refs[t].resetFields()},handleNodeModalChange:function(t){!t&&this.handleReset("nodeModal")},handleCancel:function(){this.handleReset("nodeModal"),this.isNodeModal=!1},handleAdd:function(){var t=this;this.$refs.nodeModal.getFormData().then(function(a){t.handleCancel();var e=i()({},a,t.dragObj),n=i()({},t.dragData);n.nodes.push(e),t.dragData=d()({},n)}).catch(function(){t.$Message.error("error")})}}};var _=function(t){e(374)},D=Object(C.a)(x,function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"flow-chart"},[e("PageDemo",[e("template",{slot:"page-title"},[t._v("FireLeaf 🍂 FlowChart")]),t._v(" "),e("template",{slot:"page-quote"},[t._v("\n        简易流程图 "),e("a",{attrs:{href:"https://d3js.org/",target:"_blank"}},[t._v("d3JS")])]),t._v(" "),e("template",{slot:"page-desc"},[t._v("\n        使用拖拽节点组件，进行流程图绘制\n      ")]),t._v(" "),e("div",{staticClass:"chart-body"},[e("div",{staticClass:"chart-icons-box"},[e("span",{staticClass:"hover-bg pointer",on:{click:t.handleLock}},[t.isLock?e("Icon",{attrs:{type:"locked",title:"锁定"}}):e("Icon",{attrs:{type:"unlocked",title:"解锁"}})],1),t._v(" "),e("span",{staticClass:"hover-bg pointer",on:{click:t.handleRunFlow}},[e("Icon",{attrs:{type:"play",title:"运行"}})],1),t._v(" "),e("span",{staticClass:"hover-bg pointer hide"},[e("Icon",{attrs:{type:"network",title:"布局"}})],1),t._v(" "),e("span",{staticClass:"hover-bg pointer",on:{click:t.handleZoomBig}},[e("Icon",{attrs:{type:"ios-plus",title:"放大"}})],1),t._v(" "),e("span",{staticClass:"hover-bg pointer",on:{click:t.handleZoomSmall}},[e("Icon",{attrs:{type:"ios-minus",title:"缩小"}})],1),t._v(" "),e("span",{staticClass:"hover-bg pointer",on:{click:t.handleZoomRepeat}},[e("Icon",{attrs:{type:"refresh",title:"缩放恢复"}})],1)]),t._v(" "),e("div",{staticClass:"chart-nodes-box"},[e("Card",[e("p",{attrs:{slot:"title"},slot:"title"},[t._v("节点组件")]),t._v(" "),e("div",{staticClass:"chart-nodes-type"},[e("div",[e("p",{staticClass:"chart-nodes-type-title"},[e("b",[t._v("流程任务节点")])]),t._v(" "),e("ul",{staticClass:"chart-nodes-type-list"},[e("li",{staticClass:"success-bg",attrs:{draggable:"true","data-key":"0"},on:{dragstart:t.handleIconDrag}},[t._v("任务A")])])]),t._v(" "),e("div",[e("p",{staticClass:"chart-nodes-type-title"},[e("b",[t._v("脚本节点")])]),t._v(" "),e("ul",{staticClass:"chart-nodes-type-list"},[e("li",{staticClass:"default-bg",attrs:{draggable:"true","data-key":"1"},on:{dragstart:t.handleIconDrag}},[t._v("脚本A")])])]),t._v(" "),e("div",[e("p",{staticClass:"chart-nodes-type-title"},[e("b",[t._v("虚节点")])]),t._v(" "),e("ul",{staticClass:"chart-nodes-type-list"},[e("li",{staticClass:"warn-bg",attrs:{draggable:"true","data-key":"start"},on:{dragstart:t.handleIconDrag}},[t._v("start")]),t._v(" "),e("li",{staticClass:"warn-bg",attrs:{draggable:"true","data-key":"end"},on:{dragstart:t.handleIconDrag}},[t._v("end")])])])])])],1),t._v(" "),e("div",{staticClass:"chart-flow-box",on:{drop:t.handleDrop,dragover:function(t){t.preventDefault()}}},[e("CFlowChart",{attrs:{data:t.dragData,options:t.chartOptions},on:{zoomChange:t.handleZoomChange,nodesChange:t.handleNodesChange,linksChange:t.handleLinksChange,editNode:t.handleEditNode,deleteNode:t.handleDeleteNode,deleteLink:t.handleDeleteLink}})],1)])],2),t._v(" "),e("Modal",{attrs:{title:"节点modal",styles:{top:"50px"},"mask-closable":!1},on:{"on-visible-change":t.handleNodeModalChange},model:{value:t.isNodeModal,callback:function(a){t.isNodeModal=a},expression:"isNodeModal"}},[e("NodeModal",{ref:"nodeModal"}),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("添加")]),t._v(" "),e("Button",{attrs:{type:"ghost"},on:{click:t.handleCancel}},[t._v("取消")])],1)],1)],1)},[],!1,_,"data-v-e6276bd0",null);a.default=D.exports}}]);