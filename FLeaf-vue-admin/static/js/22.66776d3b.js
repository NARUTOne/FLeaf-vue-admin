(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{277:function(t,e,a){},347:function(t,e,a){"use strict";var o=a(277);a.n(o).a},356:function(t,e,a){"use strict";a.r(e);var o=a(2),n=a.n(o),s=a(6),i=a.n(s),l=a(237),r=a(280),d=a(254),c=a(24),h=a(242),g=a(82),u=a(7),p=a.n(u),f=a(253),v=a(264),m={name:"NodeModal",components:{Form:a(282).a,FormItem:v.a,Input:f.a},props:{data:{type:Object,default:function(){return{}}}},data:function(){return{formModal:{},ruleInline:{label:[{required:!0,message:"请输入节点名称",trigger:"blur"}]}}},watch:{data:function(){this.formModal=n()({},this.data)}},mounted:function(){this.formModal=n()({},this.data)},methods:{getFormData:function(){var t=this;return new p.a(function(e,a){t.$refs.formModal.validate(function(o){if(o){var s=n()({},t.formModal);e(s)}else a()})})},resetFields:function(){this.$refs.formModal.resetFields()}}},k=a(0),C=Object(k.a)(m,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Form",{ref:"formModal",attrs:{model:t.formModal,rules:t.ruleInline}},[a("FormItem",{attrs:{prop:"label"}},[a("Input",{attrs:{type:"text",placeholder:"节点名称"},model:{value:t.formModal.label,callback:function(e){t.$set(t.formModal,"label",e)},expression:"formModal.label"}})],1)],1)},[],!1,null,null,null);C.options.__file="nodeModal.vue";var b=C.exports,_={name:"FlowChart",components:{Icon:c.a,Card:d.a,PageDemo:h.a,CFlowChart:g.b,Modal:r.a,Button:l.a,NodeModal:b},data:function(){return{isChange:!1,isNodeModal:!1,chartOptions:{zoom:{x:0,y:0,scale:1},isLock:!0,isShowLegend:!1},dragObj:{},dragData:{nodes:[],edges:[]}}},computed:{isLock:function(){return this.chartOptions.isLock}},methods:{checkLock:function(){return!!this.chartOptions.isLock&&(this.$Message.warning("当前处于锁定状态，请解锁后操作！"),!0)},handleIconDrag:function(t){if(!this.checkLock()){var e=t.target.dataset.key;t.dataTransfer.setData("text",e)}},handleDrop:function(t){if(!this.checkLock()){t.preventDefault();var e=this.chartOptions,a=t.dataTransfer.getData("text"),o=document.getElementById("force-svg"),n={type:a,posX:(t.pageX-o.getBoundingClientRect().left-e.zoom.x)/e.zoom.scale,posY:(t.pageY-o.getBoundingClientRect().top-e.zoom.y-30)/e.zoom.scale};"start"==a?(n.label=a,n.type="-1",this.handleVirOk(n)):"end"==a?(n.label=a,n.type="-2",this.handleVirOk(n)):(n.type=a,this.dragObj=i()({},n),this.isNodeModal=!0)}},handleVirOk:function(t){var e=n()({},t),a=n()({},this.dragData);a.nodes.push(e),this.dragData=i()({},a),this.isChange=!0},handleRunFlow:function(){this.$Message.info("运行流程图！")},handleLock:function(){var t=n()({},this.chartOptions),e=!this.chartOptions.isLock;t.isLock=e,this.chartOptions=i()({},t)},handleZoomRepeat:function(){if(!this.checkLock()){var t=n()({},this.chartOptions);t.zoom=n()({},{x:0,y:0,scale:1}),this.chartOptions=i()({},t)}},handleZoomBig:function(){if(!this.checkLock()){var t=n()({},this.chartOptions);t.zoom.scale>3||(t.zoom.scale=t.zoom.scale+.3,this.chartOptions=i()({},t))}},handleZoomSmall:function(){if(!this.checkLock()){var t=n()({},this.chartOptions),e=t.zoom.scale;t.zoom.scale<.2||(t.zoom.scale=e-.2,this.chartOptions=i()({},t))}},handleZoomChange:function(t){if(!this.checkLock()){var e=n()({},this.chartOptions);e.zoom=t,this.chartOptions=i()({},e)}},handleNodesChange:function(t){this.checkLock()||(this.dragData.nodes=t,this.handleChartChange())},handleLinksChange:function(t){this.checkLock()||(this.dragData.edges=t,this.handleChartChange())},handleDeleteNode:function(t){if(!this.checkLock()){var e=n()({},this.dragData),a={nodes:e.nodes.filter(function(e){return e.id!=t.id}),edges:e.edges.filter(function(e){return e.sourceId!==t.id||e.targetId!==t.id})};this.dragData=n()({},a),this.handleChartChange()}},handleEditNode:function(t){this.checkLock()||this.$Message.warning(t.nodeId+"节点编辑！")},handleDeleteLink:function(t){if(!this.checkLock()){var e=n()({},this.dragData),a=e.edges.filter(function(e){return e.sourceId!=t.sourceId||e.targetId!=t.targetId}),o={nodes:e.nodes,edges:a};this.dragData=n()({},o),this.handleChartChange()}},handleChartChange:function(){this.isChange=!0},handleReset:function(t){this.$refs[t].resetFields()},handleNodeModalChange:function(t){!t&&this.handleReset("nodeModal")},handleCancel:function(){this.handleReset("nodeModal"),this.isNodeModal=!1},handleAdd:function(){var t=this;this.$refs.nodeModal.getFormData().then(function(e){t.handleCancel();var a=n()({},e,t.dragObj),o=n()({},t.dragData);o.nodes.push(a),console.log(o),t.dragData=i()({},o)}).catch(function(){t.$Message.error("error")})}}},y=(a(347),Object(k.a)(_,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flow-chart"},[a("PageDemo",[a("template",{slot:"page-title"},[t._v("FireLeaf 🍂 FlowChart")]),t._v(" "),a("template",{slot:"page-quote"},[t._v("\n        简易流程图 "),a("a",{attrs:{href:"https://d3js.org/",target:"_blank"}},[t._v("d3JS")])]),t._v(" "),a("template",{slot:"page-desc"},[t._v("\n        使用拖拽节点组件，进行流程图绘制\n      ")]),t._v(" "),a("div",{staticClass:"chart-body"},[a("div",{staticClass:"chart-icons-box"},[a("span",{staticClass:"hover-bg pointer",on:{click:t.handleLock}},[t.isLock?a("Icon",{attrs:{type:"locked",title:"锁定"}}):a("Icon",{attrs:{type:"unlocked",title:"解锁"}})],1),t._v(" "),a("span",{staticClass:"hover-bg pointer",on:{click:t.handleRunFlow}},[a("Icon",{attrs:{type:"play",title:"运行"}})],1),t._v(" "),a("span",{staticClass:"hover-bg pointer hide"},[a("Icon",{attrs:{type:"network",title:"布局"}})],1),t._v(" "),a("span",{staticClass:"hover-bg pointer",on:{click:t.handleZoomBig}},[a("Icon",{attrs:{type:"ios-plus",title:"放大"}})],1),t._v(" "),a("span",{staticClass:"hover-bg pointer",on:{click:t.handleZoomSmall}},[a("Icon",{attrs:{type:"ios-minus",title:"缩小"}})],1),t._v(" "),a("span",{staticClass:"hover-bg pointer",on:{click:t.handleZoomRepeat}},[a("Icon",{attrs:{type:"refresh",title:"缩放恢复"}})],1)]),t._v(" "),a("div",{staticClass:"chart-nodes-box"},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("节点组件")]),t._v(" "),a("div",{staticClass:"chart-nodes-type"},[a("div",[a("p",{staticClass:"chart-nodes-type-title"},[a("b",[t._v("流程任务节点")])]),t._v(" "),a("ul",{staticClass:"chart-nodes-type-list"},[a("li",{staticClass:"success-bg",attrs:{draggable:"true","data-key":"0"},on:{dragstart:t.handleIconDrag}},[t._v("任务A")])])]),t._v(" "),a("div",[a("p",{staticClass:"chart-nodes-type-title"},[a("b",[t._v("脚本节点")])]),t._v(" "),a("ul",{staticClass:"chart-nodes-type-list"},[a("li",{staticClass:"default-bg",attrs:{draggable:"true","data-key":"1"},on:{dragstart:t.handleIconDrag}},[t._v("脚本A")])])]),t._v(" "),a("div",[a("p",{staticClass:"chart-nodes-type-title"},[a("b",[t._v("虚节点")])]),t._v(" "),a("ul",{staticClass:"chart-nodes-type-list"},[a("li",{staticClass:"warn-bg",attrs:{draggable:"true","data-key":"start"},on:{dragstart:t.handleIconDrag}},[t._v("start")]),t._v(" "),a("li",{staticClass:"warn-bg",attrs:{draggable:"true","data-key":"end"},on:{dragstart:t.handleIconDrag}},[t._v("end")])])])])])],1),t._v(" "),a("div",{staticClass:"chart-flow-box",on:{drop:t.handleDrop,dragover:function(t){t.preventDefault()}}},[a("CFlowChart",{attrs:{data:t.dragData,options:t.chartOptions,zoomChange:t.handleZoomChange,nodesChange:t.handleNodesChange,linksChange:t.handleLinksChange,editNode:t.handleEditNode,deleteNode:t.handleDeleteNode,deleteLink:t.handleDeleteLink}})],1)])],2),t._v(" "),a("Modal",{attrs:{title:"节点modal",styles:{top:"50px"},"mask-closable":!1},on:{"on-visible-change":t.handleNodeModalChange},model:{value:t.isNodeModal,callback:function(e){t.isNodeModal=e},expression:"isNodeModal"}},[a("NodeModal",{ref:"nodeModal"}),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:t.handleAdd}},[t._v("添加")]),t._v(" "),a("Button",{attrs:{type:"ghost"},on:{click:t.handleCancel}},[t._v("取消")])],1)],1)],1)},[],!1,null,"43f37250",null));y.options.__file="index.vue";e.default=y.exports}}]);